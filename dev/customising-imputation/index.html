<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Customising the imputation setup · Mice.jl</title><meta name="title" content="Customising the imputation setup · Mice.jl"/><meta property="og:title" content="Customising the imputation setup · Mice.jl"/><meta property="twitter:title" content="Customising the imputation setup · Mice.jl"/><meta name="description" content="Documentation for Mice.jl."/><meta property="og:description" content="Documentation for Mice.jl."/><meta property="twitter:description" content="Documentation for Mice.jl."/><script async src="https://www.googletagmanager.com/gtag/js?id=G-0SJ9WPE2ZH"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-0SJ9WPE2ZH', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Mice.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">What is <code>Mice.jl</code>?</a></li><li><a class="tocitem" href="../gettingstarted/">Getting started</a></li><li><a class="tocitem" href="../wrangling/">Data wrangling in Julia</a></li><li><span class="tocitem">Imputation</span><ul><li><a class="tocitem" href="../mice/">Imputation (<code>mice</code>)</a></li><li class="is-active"><a class="tocitem" href>Customising the imputation setup</a><ul class="internal"><li><a class="tocitem" href="#Locations-to-impute"><span>Locations to impute</span></a></li><li><a class="tocitem" href="#Visit-sequence"><span>Visit sequence</span></a></li><li><a class="tocitem" href="#Predictor-matrix"><span>Predictor matrix</span></a></li><li><a class="tocitem" href="#Methods"><span>Methods</span></a></li></ul></li><li><a class="tocitem" href="../diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../binding-imputations/">Binding imputations together</a></li></ul></li><li><a class="tocitem" href="../analysis/">Analysis (<code>with</code>)</a></li><li><a class="tocitem" href="../pooling/">Pooling coefficients (<code>pool</code>)</a></li><li><a class="tocitem" href="../rcall/">Integration with R</a></li><li><a class="tocitem" href="../multithreading/">Multithreading</a></li><li><a class="tocitem" href="../benchmarks/">Benchmarks</a></li><li><a class="tocitem" href="../issues/">Issues</a></li><li><a class="tocitem" href="../whatsnext/">What&#39;s next?</a></li><li><a class="tocitem" href="../acknowledgements/">Acknowledgements</a></li><li><a class="tocitem" href="../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Imputation</a></li><li class="is-active"><a href>Customising the imputation setup</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Customising the imputation setup</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/tom-metherell/Mice.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/tom-metherell/Mice.jl/blob/main/docs/src/customising-imputation.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Customising-the-imputation-setup"><a class="docs-heading-anchor" href="#Customising-the-imputation-setup">Customising the imputation setup</a><a id="Customising-the-imputation-setup-1"></a><a class="docs-heading-anchor-permalink" href="#Customising-the-imputation-setup" title="Permalink"></a></h1><p>You can customise various aspects of the imputation setup by passing keyword arguments to <code>mice</code>. These are described above. You can also use some of the functions below to define objects that you can customise to alter how <code>mice</code> handles the imputation.</p><h2 id="Locations-to-impute"><a class="docs-heading-anchor" href="#Locations-to-impute">Locations to impute</a><a id="Locations-to-impute-1"></a><a class="docs-heading-anchor-permalink" href="#Locations-to-impute" title="Permalink"></a></h2><p>You can customise which data points are imputed by manipulating the <code>imputeWhere</code> argument. By default, this will specify that all missing data are to be imputed (using the function <code>findMissings()</code>).</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mice.findMissings" href="#Mice.findMissings"><code>Mice.findMissings</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">findMissings(data)</code></pre><p>Returns an AxisVector of boolean vectors describing the locations of missing data in each column of the provided data table.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/tom-metherell/Mice.jl/blob/061d9e5bd1327b788cbc4dc9e7ec35b3fe6e759b/src/makeFunctions.jl#L1-L6">source</a></section></article><p>You can over-impute existing data by setting the locations of non-missing data to <code>true</code> in the relevant vector in <code>imputeWhere</code>. For example, to over-impute the value of <code>col1</code> for the first row, you could do the following:</p><pre><code class="language-julia hljs">using DataFrames, Mice, Random

myData = DataFrame(
    :col1 =&gt; Vector{Union{Missing, Float64}}([1.0, missing, 3.0, missing, 5.0]),
    :col2 =&gt; Vector{Union{Missing, Int64}}([1, 2, missing, 4, 5]),
    :col3 =&gt; Vector{Union{Missing, String}}([missing, &quot;2&quot;, missing, &quot;4&quot;, missing])
);

myImputeWhere = findMissings(myData)
# 1-dimensional AxisArray{Vector{Bool},1,...} with axes:
#     :row, [&quot;col1&quot;, &quot;col2&quot;, &quot;col3&quot;]
# And data, a 3-element Vector{Vector{Bool}}:
#  [0, 1, 0, 1, 0]
#  [0, 0, 1, 0, 0]
#  [1, 0, 1, 0, 1]

myImputeWhere[&quot;col1&quot;][1] = true;
myImputeWhere
# 1-dimensional AxisArray{Vector{Bool},1,...} with axes:
#     :row, [&quot;col1&quot;, &quot;col2&quot;, &quot;col3&quot;]
# And data, a 3-element Vector{Vector{Bool}}:
#  [1, 1, 0, 1, 0]
#  [0, 0, 1, 0, 0]
#  [1, 0, 1, 0, 1]

# Not run
mice(myData, imputeWhere = myImputeWhere)</code></pre><h2 id="Visit-sequence"><a class="docs-heading-anchor" href="#Visit-sequence">Visit sequence</a><a id="Visit-sequence-1"></a><a class="docs-heading-anchor-permalink" href="#Visit-sequence" title="Permalink"></a></h2><p>The visit sequence is the order in which the variables are imputed. By default, <code>mice</code> sorts the variables in order of missingness (lowest to highest) via the internal function <code>makeMonotoneSequence</code>. You can instead define your own visit sequence by creating a vector of variable names in your desired order and passing that to <code>mice</code>. For example:</p><pre><code class="language-julia hljs">using DataFrames, Mice, Random

myData = DataFrame(
    :col1 =&gt; Vector{Union{Missing, Float64}}([1.0, missing, 3.0, missing, 5.0]),
    :col2 =&gt; Vector{Union{Missing, Int64}}([1, 2, missing, 4, 5]),
    :col3 =&gt; Vector{Union{Missing, String}}([missing, &quot;2&quot;, missing, &quot;4&quot;, missing])
);

Mice.makeMonotoneSequence(findMissings(myData))
# 3-element Vector{String}:
#  &quot;col2&quot;
#  &quot;col1&quot;
#  &quot;col3&quot;

myVisitSequence1 = names(myData)
# 3-element Vector{String}:
# &quot;col1&quot;
# &quot;col2&quot;
# &quot;col3&quot;

Random.seed!(1234); # Set random seed for reproducibility

# Not run
mice(myData, visitSequence = myVisitSequence1)

myVisitSequence2 = [&quot;col3&quot;, &quot;col1&quot;, &quot;col2&quot;]
# 3-element Vector{String}:
# &quot;col3&quot;
# &quot;col1&quot;
# &quot;col2&quot;

# Not run
mice(myData, visitSequence = myVisitSequence2)</code></pre><p>Assuming that the imputations converge normally, changing the visit sequence should not dramatically affect the output. However, it can be useful to change the visit sequence if you want to impute variables in a particular order for a specific reason. The sequence used by default in <code>Mice.jl</code> can make convergence faster in cases where the data follow a (near-)&quot;monotone&quot; missing data pattern [<a href="../references/#van_buuren_flexible_2018">2</a>].</p><p>You can leave variables out of the <code>visitSequence</code> to cause <code>mice()</code> to not impute them.</p><h2 id="Predictor-matrix"><a class="docs-heading-anchor" href="#Predictor-matrix">Predictor matrix</a><a id="Predictor-matrix-1"></a><a class="docs-heading-anchor-permalink" href="#Predictor-matrix" title="Permalink"></a></h2><p>The predictor matrix defines which variables in the imputation model are used to predict which others. By default, every variable predicts every other variable, but there are a wide range of cases in which this is not desirable. For example, if your dataset includes an ID column, this is clearly useless for imputation and should be ignored.</p><p>To create a default predictor matrix that you can edit, you can use the function <code>makePredictorMatrix</code>.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mice.makePredictorMatrix" href="#Mice.makePredictorMatrix"><code>Mice.makePredictorMatrix</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">makePredictorMatrix(data)</code></pre><p>Returns an AxisMatrix of integers defining the predictors for each variable in <code>data</code>. The variables to be predicted are on the rows, and the predictors are on the columns. The default is to use all variables as predictors for all other variables (i.e. all 1s except for the diagonal, which is 0).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/tom-metherell/Mice.jl/blob/061d9e5bd1327b788cbc4dc9e7ec35b3fe6e759b/src/makeFunctions.jl#L47-L54">source</a></section></article><p>You can then edit the predictor matrix to remove any predictive relationships that you do not want to include in the imputation model. For example:</p><pre><code class="language-julia hljs">using DataFrames, Mice, Random

myData = DataFrame(
    :id =&gt; Vector{Int64}(1:5),
    :col1 =&gt; Vector{Union{Missing, Float64}}([1.0, missing, 3.0, missing, 5.0]),
    :col2 =&gt; Vector{Union{Missing, Int64}}([1, 2, missing, 4, 5]),
    :col3 =&gt; Vector{Union{Missing, String}}([missing, &quot;2&quot;, missing, &quot;4&quot;, missing])
);

myPredictorMatrix = makePredictorMatrix(myData)
# 2-dimensional AxisArray{Int64,2,...} with axes:
#     :row, [&quot;id&quot;, &quot;col1&quot;, &quot;col2&quot;, &quot;col3&quot;]
#     :col, [&quot;id&quot;, &quot;col1&quot;, &quot;col2&quot;, &quot;col3&quot;]
# And data, a 4x4 Matrix{Int64}:
#  0  1  1  1
#  1  0  1  1
#  1  1  0  1
#  1  1  1  0

# To stop the ID column from predicting any other variable
myPredictorMatrix[:, &quot;id&quot;] .= 0;
myPredictorMatrix
# 2-dimensional AxisArray{Int64,2,...} with axes:
#     :row, [&quot;id&quot;, &quot;col1&quot;, &quot;col2&quot;, &quot;col3&quot;]
#     :col, [&quot;id&quot;, &quot;col1&quot;, &quot;col2&quot;, &quot;col3&quot;]
# And data, a 4x4 Matrix{Int64}:
#  0  1  1  1
#  0  0  1  1
#  0  1  0  1
#  0  1  1  0

# To stop col1 from predicting col3
myPredictorMatrix[&quot;col3&quot;, &quot;col1&quot;] = false;
myPredictorMatrix
# 2-dimensional AxisArray{Int64,2,...} with axes:
#     :row, [&quot;id&quot;, &quot;col1&quot;, &quot;col2&quot;, &quot;col3&quot;]
#     :col, [&quot;id&quot;, &quot;col1&quot;, &quot;col2&quot;, &quot;col3&quot;]
# And data, a 4x4 Matrix{Int64}:
#  0  1  1  1
#  0  0  1  1
#  0  1  0  1
#  0  0  1  0

Random.seed!(1234); # Set random seed for reproducibility

# Not run
mice(myData, predictorMatrix = myPredictorMatrix)</code></pre><h2 id="Methods"><a class="docs-heading-anchor" href="#Methods">Methods</a><a id="Methods-1"></a><a class="docs-heading-anchor-permalink" href="#Methods" title="Permalink"></a></h2><p>The imputation methods are the functions that are used to impute each variable. By default, <code>mice</code> uses predictive mean matching (<code>&quot;pmm&quot;</code>) for all variables. Currently <code>Mice.jl</code> supports the following methods:</p><table><tr><th style="text-align: right">Method</th><th style="text-align: right">Description</th><th style="text-align: right">Variable type</th></tr><tr><td style="text-align: right"><code>pmm</code></td><td style="text-align: right">Predictive mean matching</td><td style="text-align: right">Any</td></tr><tr><td style="text-align: right"><code>rf</code></td><td style="text-align: right">Random forest</td><td style="text-align: right">Any (but see <a href="#rf-warning">below</a>)</td></tr><tr><td style="text-align: right"><code>sample</code></td><td style="text-align: right">Random sample from observed values</td><td style="text-align: right">Any</td></tr><tr><td style="text-align: right"><code>mean</code></td><td style="text-align: right">Mean of observed values</td><td style="text-align: right">Numeric (float)</td></tr><tr><td style="text-align: right"><code>norm</code></td><td style="text-align: right">Bayesian linear regression</td><td style="text-align: right">Numeric (float)</td></tr></table><a name="rf-warning">
</a> <div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>If you use <code>rf</code> on a variable with integer values, the imputed values will be rounded to the nearest integer in the output. If you want to prevent this behaviour, you have two options:</p><ul><li><p>Convert the variable to a float before imputation, so it is treated as continuous or</p></li><li><p>Convert the variable to a categorical/string array so it is treated as discrete.</p></li></ul></div></div><p>The <code>mean</code> and <code>sample</code> methods should not generally be used.</p><p>To create a default methods vector, use the function <code>makeMethods</code>.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mice.makeMethods" href="#Mice.makeMethods"><code>Mice.makeMethods</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">makeMethods(data)</code></pre><p>Returns an AxisVector of strings defining the method by which each variable in <code>data</code> should be imputed in the <code>mice()</code> function. The default method is predictive mean matching (pmm).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/tom-metherell/Mice.jl/blob/061d9e5bd1327b788cbc4dc9e7ec35b3fe6e759b/src/makeFunctions.jl#L25-L31">source</a></section></article><p>You can then customise the vector as needed. For example:</p><pre><code class="language-julia hljs">using DataFrames, Mice, Random

myData = DataFrame(
    :id =&gt; Vector{Int64}(1:5),
    :col1 =&gt; Vector{Union{Missing, Float64}}([1.0, missing, 3.0, missing, 5.0]),
    :col2 =&gt; Vector{Union{Missing, Int64}}([1, 2, missing, 4, 5]),
    :col3 =&gt; Vector{Union{Missing, String}}([missing, &quot;2&quot;, missing, &quot;4&quot;, missing])
);

myMethods = makeMethods(myData)
# 1-dimensional AxisArray{String,1,...} with axes:
#     :row, [&quot;id&quot;, &quot;col1&quot;, &quot;col2&quot;, &quot;col3&quot;]
# And data, a 4-element Vector{String}:
#  &quot;pmm&quot;
#  &quot;pmm&quot;
#  &quot;pmm&quot;
#  &quot;pmm&quot;

# To stop the ID column from being imputed (but you can also achieve this by leaving &quot;id&quot;
# out of the visit sequence)
myMethods[&quot;id&quot;] = &quot;&quot;;
myMethods
# 1-dimensional AxisArray{String,1,...} with axes:
#     :row, [&quot;id&quot;, &quot;col1&quot;, &quot;col2&quot;, &quot;col3&quot;]
# And data, a 4-element Vector{String}:
#  &quot;&quot;
#  &quot;pmm&quot;
#  &quot;pmm&quot;
#  &quot;pmm&quot;

# To use Bayesian linear regression to impute col1
myMethods[&quot;col1&quot;] = &quot;norm&quot;;
myMethods
# 1-dimensional AxisArray{String,1,...} with axes:
#     :row, [&quot;id&quot;, &quot;col1&quot;, &quot;col2&quot;, &quot;col3&quot;]
# And data, a 4-element Vector{String}:
#  &quot;&quot;
#  &quot;norm&quot;
#  &quot;pmm&quot;
#  &quot;pmm&quot;

Random.seed!(1234); # Set random seed for reproducibility

# Not run
mice(myData, methods = myMethods)</code></pre><br> <div align="right"> Funded by Wellcome &nbsp;&nbsp;&nbsp; <img src="../wellcome-logo-white.png" style="vertical-align:middle" alt="Wellcome logo" width="50" height="50"> </div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../mice/">« Imputation (<code>mice</code>)</a><a class="docs-footer-nextpage" href="../diagnostics/">Diagnostics »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Tuesday 11 February 2025 17:48">Tuesday 11 February 2025</span>. Using Julia version 1.9.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
